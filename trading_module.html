<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XtQuant 交易接口模块</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 280px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .sidebar-header h2 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .sidebar-header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .nav-menu {
            padding: 20px 0;
        }
        
        .nav-section {
            margin-bottom: 20px;
        }
        
        .nav-section h3 {
            padding: 10px 20px;
            font-size: 0.9rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid #eee;
        }
        
        .nav-section ul {
            list-style: none;
        }
        
        .nav-section li {
            margin: 2px 0;
        }
        
        .nav-section a {
            display: block;
            padding: 8px 20px;
            color: #555;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .nav-section a:hover {
            background: #f0f0f0;
            color: #667eea;
            padding-left: 25px;
        }
        
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 40px;
        }
        
        .page-header {
            margin-bottom: 40px;
            text-align: center;
        }
        
        .page-header h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .page-header p {
            font-size: 1.1rem;
            color: #666;
        }
        
        .api-section {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .api-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            font-size: 1.8rem;
        }
        
        .api-method {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            background: #fafbfc;
        }
        
        .api-method h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .method-signature {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            margin-bottom: 15px;
            overflow-x: auto;
        }
        
        .method-info {
            margin-bottom: 15px;
        }
        
        .method-info h4 {
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .method-info p, .method-info li {
            color: #666;
            line-height: 1.6;
        }
        
        .method-info ul {
            margin-left: 20px;
        }
        
        .code-example {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            margin-top: 15px;
            overflow-x: auto;
        }
        
        .back-link {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }
        
        .back-link:hover {
            background: linear-gradient(135deg, #5a6fd8, #6a4190);
            transform: translateY(-2px);
        }
        
        .highlight {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .highlight strong {
            color: #856404;
        }
        
        .info-box {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .info-box strong {
            color: #0c5460;
        }
        
        .warning-box {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .warning-box strong {
            color: #721c24;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        .data-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>交易接口模块</h2>
                <p>股票交易相关API</p>
            </div>
            <nav class="nav-menu">
                <div class="nav-section">
                    <h3>下单接口</h3>
                    <ul>
                        <li><a href="#order_stock">同步下单</a></li>
                        <li><a href="#order_stock_async">异步下单</a></li>
                    </ul>
                </div>
                <div class="nav-section">
                    <h3>撤单接口</h3>
                    <ul>
                        <li><a href="#cancel_order_stock">同步撤单</a></li>
                        <li><a href="#cancel_order_stock_async">异步撤单</a></li>
                        <li><a href="#cancel_order_stock_sysid">按合同号撤单</a></li>
                        <li><a href="#cancel_order_stock_sysid_async">按合同号异步撤单</a></li>
                    </ul>
                </div>
                <div class="nav-section">
                    <h3>订单类型</h3>
                    <ul>
                        <li><a href="#order_types">订单类型说明</a></li>
                        <li><a href="#price_types">价格类型说明</a></li>
                    </ul>
                </div>
                <div class="nav-section">
                    <h3>交易策略</h3>
                    <ul>
                        <li><a href="#trading_strategy">交易策略示例</a></li>
                        <li><a href="#risk_control">风险控制</a></li>
                    </ul>
                </div>
            </nav>
        </div>
        
        <div class="main-content">
            <a href="xtquant_api_modules.html" class="back-link">← 返回模块首页</a>
            
            <div class="page-header">
                <h1>交易接口模块</h1>
                <p>股票交易相关的API接口文档</p>
            </div>
            
            <div class="warning-box">
                <strong>风险提示:</strong> 股票交易存在风险，使用API进行自动化交易前请充分了解相关风险，并做好风险控制措施。
            </div>
            
            <div class="api-section">
                <h2>下单接口</h2>
                
                <div class="api-method" id="order_stock">
                    <h3>股票同步下单</h3>
                    <div class="method-signature">order_stock(account, stock_code, order_type, order_volume, price_type, price, strategy_name='', order_remark='')</div>
                    
                    <div class="method-info">
                        <h4>功能说明</h4>
                        <p>进行股票同步下单操作，函数会等待下单结果返回。</p>
                        
                        <h4>参数</h4>
                        <ul>
                            <li><strong>account</strong> (StockAccount): 资金账号对象</li>
                            <li><strong>stock_code</strong> (str): 证券代码，如'000001.SZ'</li>
                            <li><strong>order_type</strong> (int): 订单类型，23=买入，24=卖出</li>
                            <li><strong>order_volume</strong> (int): 委托数量（股）</li>
                            <li><strong>price_type</strong> (int): 价格类型，11=限价，12=市价</li>
                            <li><strong>price</strong> (float): 委托价格</li>
                            <li><strong>strategy_name</strong> (str): 策略名称，可选</li>
                            <li><strong>order_remark</strong> (str): 订单备注，可选</li>
                        </ul>
                        
                        <h4>返回值</h4>
                        <p>int - 订单编号，-1表示下单失败</p>
                        
                        <div class="highlight">
                            <strong>注意:</strong> 同步下单会阻塞程序执行，直到收到下单结果。对于高频交易建议使用异步下单。
                        </div>
                        
                        <h4>示例代码</h4>
                        <div class="code-example">
# 股票买入示例
account = StockAccount('123456789')

# 限价买入1000股平安银行
order_id = xt_trader.order_stock(
    account=account,
    stock_code='000001.SZ',
    order_type=23,        # 买入
    order_volume=1000,    # 1000股
    price_type=11,        # 限价
    price=12.50,          # 12.50元
    strategy_name='价值投资',
    order_remark='定投买入'
)

if order_id != -1:
    print(f"下单成功，订单号: {order_id}")
else:
    print("下单失败")

# 市价卖出500股
sell_order_id = xt_trader.order_stock(
    account=account,
    stock_code='000001.SZ',
    order_type=24,        # 卖出
    order_volume=500,     # 500股
    price_type=12,        # 市价
    price=0               # 市价时价格可设为0
)

if sell_order_id != -1:
    print(f"卖出成功，订单号: {sell_order_id}")
else:
    print("卖出失败")
                        </div>
                    </div>
                </div>
                
                <div class="api-method" id="order_stock_async">
                    <h3>股票异步下单</h3>
                    <div class="method-signature">order_stock_async(account, stock_code, order_type, order_volume, price_type, price, strategy_name='', order_remark='')</div>
                    
                    <div class="method-info">
                        <h4>功能说明</h4>
                        <p>进行股票异步下单操作，函数立即返回，不等待下单结果。</p>
                        
                        <h4>参数</h4>
                        <ul>
                            <li><strong>account</strong> (StockAccount): 资金账号对象</li>
                            <li><strong>stock_code</strong> (str): 证券代码</li>
                            <li><strong>order_type</strong> (int): 订单类型</li>
                            <li><strong>order_volume</strong> (int): 委托数量</li>
                            <li><strong>price_type</strong> (int): 价格类型</li>
                            <li><strong>price</strong> (float): 委托价格</li>
                            <li><strong>strategy_name</strong> (str): 策略名称，可选</li>
                            <li><strong>order_remark</strong> (str): 订单备注，可选</li>
                        </ul>
                        
                        <h4>返回值</h4>
                        <p>int - 请求序号，用于在回调函数中识别订单</p>
                        
                        <div class="info-box">
                            <strong>异步下单说明:</strong> 异步下单的结果通过回调函数返回，需要注册相应的回调函数来处理下单结果。
                        </div>
                        
                        <h4>示例代码</h4>
                        <div class="code-example">
# 异步下单示例
account = StockAccount('123456789')

# 注册下单回调函数
def on_order_stock(data):
    print(f"下单回调: {data}")
    if data['order_id'] != -1:
        print(f"下单成功，订单号: {data['order_id']}")
    else:
        print(f"下单失败: {data['error_msg']}")

xt_trader.register_callback(on_order_stock, 'on_order_stock')

# 异步买入
req_id = xt_trader.order_stock_async(
    account=account,
    stock_code='000001.SZ',
    order_type=23,
    order_volume=1000,
    price_type=11,
    price=12.50,
    strategy_name='量化策略'
)

print(f"异步下单请求已发送，请求ID: {req_id}")

# 批量异步下单
stocks_to_buy = [
    {'code': '000001.SZ', 'volume': 1000, 'price': 12.50},
    {'code': '000002.SZ', 'volume': 500, 'price': 25.80},
    {'code': '600000.SH', 'volume': 800, 'price': 8.90}
]

for stock in stocks_to_buy:
    req_id = xt_trader.order_stock_async(
        account=account,
        stock_code=stock['code'],
        order_type=23,
        order_volume=stock['volume'],
        price_type=11,
        price=stock['price']
    )
    print(f"提交买入 {stock['code']}，请求ID: {req_id}")
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="api-section">
                <h2>撤单接口</h2>
                
                <div class="api-method" id="cancel_order_stock">
                    <h3>股票同步撤单（按订单号）</h3>
                    <div class="method-signature">cancel_order_stock(account, order_id)</div>
                    
                    <div class="method-info">
                        <h4>功能说明</h4>
                        <p>根据订单编号进行股票同步撤单操作。</p>
                        
                        <h4>参数</h4>
                        <ul>
                            <li><strong>account</strong> (StockAccount): 资金账号对象</li>
                            <li><strong>order_id</strong> (int): 要撤销的订单编号</li>
                        </ul>
                        
                        <h4>返回值</h4>
                        <p>bool - True表示撤单成功，False表示撤单失败</p>
                        
                        <h4>示例代码</h4>
                        <div class="code-example">
# 撤单示例
account = StockAccount('123456789')
order_id = 12345  # 要撤销的订单号

# 执行撤单
result = xt_trader.cancel_order_stock(account, order_id)

if result:
    print(f"订单 {order_id} 撤单成功")
else:
    print(f"订单 {order_id} 撤单失败")
                        </div>
                    </div>
                </div>
                
                <div class="api-method" id="cancel_order_stock_async">
                    <h3>股票异步撤单（按订单号）</h3>
                    <div class="method-signature">cancel_order_stock_async(account, order_id)</div>
                    
                    <div class="method-info">
                        <h4>功能说明</h4>
                        <p>根据订单编号进行股票异步撤单操作。</p>
                        
                        <h4>参数</h4>
                        <ul>
                            <li><strong>account</strong> (StockAccount): 资金账号对象</li>
                            <li><strong>order_id</strong> (int): 要撤销的订单编号</li>
                        </ul>
                        
                        <h4>返回值</h4>
                        <p>int - 请求序号</p>
                        
                        <h4>示例代码</h4>
                        <div class="code-example">
# 异步撤单示例
account = StockAccount('123456789')

# 注册撤单回调函数
def on_cancel_order(data):
    if data['success']:
        print(f"订单 {data['order_id']} 撤单成功")
    else:
        print(f"订单 {data['order_id']} 撤单失败: {data['error_msg']}")

xt_trader.register_callback(on_cancel_order, 'on_cancel_order')

# 执行异步撤单
order_id = 12345
req_id = xt_trader.cancel_order_stock_async(account, order_id)
print(f"异步撤单请求已发送，请求ID: {req_id}")
                        </div>
                    </div>
                </div>
                
                <div class="api-method" id="cancel_order_stock_sysid">
                    <h3>股票同步撤单（按合同号）</h3>
                    <div class="method-signature">cancel_order_stock_sysid(account, order_sysid)</div>
                    
                    <div class="method-info">
                        <h4>功能说明</h4>
                        <p>根据系统合同编号进行股票同步撤单操作。</p>
                        
                        <h4>参数</h4>
                        <ul>
                            <li><strong>account</strong> (StockAccount): 资金账号对象</li>
                            <li><strong>order_sysid</strong> (str): 系统合同编号</li>
                        </ul>
                        
                        <h4>返回值</h4>
                        <p>bool - True表示撤单成功，False表示撤单失败</p>
                        
                        <h4>示例代码</h4>
                        <div class="code-example">
# 按合同号撤单示例
account = StockAccount('123456789')
order_sysid = 'SYS20231201001'  # 系统合同编号

# 执行撤单
result = xt_trader.cancel_order_stock_sysid(account, order_sysid)

if result:
    print(f"合同 {order_sysid} 撤单成功")
else:
    print(f"合同 {order_sysid} 撤单失败")
                        </div>
                    </div>
                </div>
                
                <div class="api-method" id="cancel_order_stock_sysid_async">
                    <h3>股票异步撤单（按合同号）</h3>
                    <div class="method-signature">cancel_order_stock_sysid_async(account, order_sysid)</div>
                    
                    <div class="method-info">
                        <h4>功能说明</h4>
                        <p>根据系统合同编号进行股票异步撤单操作。</p>
                        
                        <h4>参数</h4>
                        <ul>
                            <li><strong>account</strong> (StockAccount): 资金账号对象</li>
                            <li><strong>order_sysid</strong> (str): 系统合同编号</li>
                        </ul>
                        
                        <h4>返回值</h4>
                        <p>int - 请求序号</p>
                        
                        <h4>示例代码</h4>
                        <div class="code-example">
# 按合同号异步撤单示例
account = StockAccount('123456789')
order_sysid = 'SYS20231201001'

# 执行异步撤单
req_id = xt_trader.cancel_order_stock_sysid_async(account, order_sysid)
print(f"异步撤单请求已发送，请求ID: {req_id}")
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="api-section">
                <h2>订单类型说明</h2>
                
                <div class="api-method" id="order_types">
                    <h3>订单类型</h3>
                    
                    <div class="method-info">
                        <h4>常用订单类型</h4>
                        <table class="data-table">
                            <tr>
                                <th>类型代码</th>
                                <th>类型名称</th>
                                <th>说明</th>
                            </tr>
                            <tr>
                                <td>23</td>
                                <td>买入</td>
                                <td>普通买入订单</td>
                            </tr>
                            <tr>
                                <td>24</td>
                                <td>卖出</td>
                                <td>普通卖出订单</td>
                            </tr>
                            <tr>
                                <td>27</td>
                                <td>融资买入</td>
                                <td>信用账户融资买入</td>
                            </tr>
                            <tr>
                                <td>28</td>
                                <td>融券卖出</td>
                                <td>信用账户融券卖出</td>
                            </tr>
                            <tr>
                                <td>29</td>
                                <td>卖券还款</td>
                                <td>信用账户卖券还款</td>
                            </tr>
                            <tr>
                                <td>30</td>
                                <td>买券还券</td>
                                <td>信用账户买券还券</td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <div class="api-method" id="price_types">
                    <h3>价格类型</h3>
                    
                    <div class="method-info">
                        <h4>价格类型说明</h4>
                        <table class="data-table">
                            <tr>
                                <th>类型代码</th>
                                <th>类型名称</th>
                                <th>说明</th>
                            </tr>
                            <tr>
                                <td>11</td>
                                <td>限价</td>
                                <td>指定价格委托</td>
                            </tr>
                            <tr>
                                <td>12</td>
                                <td>市价</td>
                                <td>按市场价格委托</td>
                            </tr>
                            <tr>
                                <td>13</td>
                                <td>本方最优</td>
                                <td>本方最优价格委托</td>
                            </tr>
                            <tr>
                                <td>14</td>
                                <td>对方最优</td>
                                <td>对方最优价格委托</td>
                            </tr>
                            <tr>
                                <td>15</td>
                                <td>五档即成剩撤</td>
                                <td>五档范围内即成剩余撤销</td>
                            </tr>
                        </table>
                        
                        <div class="highlight">
                            <strong>注意:</strong> 不同市场和券商支持的价格类型可能有差异，请根据实际情况选择合适的价格类型。
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="api-section">
                <h2>交易策略示例</h2>
                
                <div class="api-method" id="trading_strategy">
                    <h3>智能交易策略</h3>
                    
                    <div class="method-info">
                        <h4>网格交易策略</h4>
                        <div class="code-example">
class GridTradingStrategy:
    def __init__(self, xt_trader, account, stock_code, base_price, grid_size, grid_count):
        self.xt_trader = xt_trader
        self.account = account
        self.stock_code = stock_code
        self.base_price = base_price
        self.grid_size = grid_size
        self.grid_count = grid_count
        self.orders = {}
    
    def setup_grid(self):
        """设置网格订单"""
        for i in range(1, self.grid_count + 1):
            # 买入网格
            buy_price = self.base_price - (i * self.grid_size)
            if buy_price > 0:
                order_id = self.xt_trader.order_stock(
                    account=self.account,
                    stock_code=self.stock_code,
                    order_type=23,  # 买入
                    order_volume=100,
                    price_type=11,  # 限价
                    price=buy_price,
                    strategy_name='网格交易',
                    order_remark=f'网格买入{i}'
                )
                self.orders[order_id] = {'type': 'buy', 'level': i, 'price': buy_price}
            
            # 卖出网格
            sell_price = self.base_price + (i * self.grid_size)
            order_id = self.xt_trader.order_stock(
                account=self.account,
                stock_code=self.stock_code,
                order_type=24,  # 卖出
                order_volume=100,
                price_type=11,  # 限价
                price=sell_price,
                strategy_name='网格交易',
                order_remark=f'网格卖出{i}'
            )
            self.orders[order_id] = {'type': 'sell', 'level': i, 'price': sell_price}
    
    def on_order_filled(self, order_id):
        """订单成交回调"""
        if order_id in self.orders:
            order_info = self.orders[order_id]
            print(f"网格订单成交: {order_info['type']} @ {order_info['price']}")
            
            # 重新设置对应网格
            if order_info['type'] == 'buy':
                # 买入成交，设置卖出订单
                sell_price = order_info['price'] + self.grid_size
                new_order_id = self.xt_trader.order_stock(
                    account=self.account,
                    stock_code=self.stock_code,
                    order_type=24,
                    order_volume=100,
                    price_type=11,
                    price=sell_price
                )
                self.orders[new_order_id] = {'type': 'sell', 'level': order_info['level'], 'price': sell_price}
            
            elif order_info['type'] == 'sell':
                # 卖出成交，设置买入订单
                buy_price = order_info['price'] - self.grid_size
                if buy_price > 0:
                    new_order_id = self.xt_trader.order_stock(
                        account=self.account,
                        stock_code=self.stock_code,
                        order_type=23,
                        order_volume=100,
                        price_type=11,
                        price=buy_price
                    )
                    self.orders[new_order_id] = {'type': 'buy', 'level': order_info['level'], 'price': buy_price}
            
            # 移除已成交订单
            del self.orders[order_id]

# 使用示例
account = StockAccount('123456789')
grid_strategy = GridTradingStrategy(
    xt_trader=xt_trader,
    account=account,
    stock_code='000001.SZ',
    base_price=12.00,
    grid_size=0.10,
    grid_count=5
)

# 启动网格交易
grid_strategy.setup_grid()
                        </div>
                        
                        <h4>止损止盈策略</h4>
                        <div class="code-example">
def stop_loss_take_profit(xt_trader, account, stock_code, entry_price, stop_loss_pct=0.05, take_profit_pct=0.10):
    """
    止损止盈策略
    
    Args:
        entry_price: 入场价格
        stop_loss_pct: 止损百分比
        take_profit_pct: 止盈百分比
    """
    stop_loss_price = entry_price * (1 - stop_loss_pct)
    take_profit_price = entry_price * (1 + take_profit_pct)
    
    print(f"设置止损价: {stop_loss_price:.2f}")
    print(f"设置止盈价: {take_profit_price:.2f}")
    
    # 这里需要结合行情数据来监控价格
    # 当价格触及止损或止盈条件时执行相应操作
    
    def check_price_and_execute(current_price):
        if current_price <= stop_loss_price:
            # 执行止损
            order_id = xt_trader.order_stock(
                account=account,
                stock_code=stock_code,
                order_type=24,  # 卖出
                order_volume=1000,  # 根据实际持仓调整
                price_type=12,  # 市价
                price=0,
                order_remark='止损卖出'
            )
            print(f"触发止损，卖出订单: {order_id}")
            
        elif current_price >= take_profit_price:
            # 执行止盈
            order_id = xt_trader.order_stock(
                account=account,
                stock_code=stock_code,
                order_type=24,  # 卖出
                order_volume=1000,  # 根据实际持仓调整
                price_type=11,  # 限价
                price=take_profit_price,
                order_remark='止盈卖出'
            )
            print(f"触发止盈，卖出订单: {order_id}")
    
    return check_price_and_execute

# 使用示例
account = StockAccount('123456789')
stop_check = stop_loss_take_profit(
    xt_trader=xt_trader,
    account=account,
    stock_code='000001.SZ',
    entry_price=12.00,
    stop_loss_pct=0.03,  # 3%止损
    take_profit_pct=0.08  # 8%止盈
)

# 在行情回调中调用
# stop_check(current_price)
                        </div>
                    </div>
                </div>
                
                <div class="api-method" id="risk_control">
                    <h3>风险控制</h3>
                    
                    <div class="method-info">
                        <h4>风险控制要点</h4>
                        <ul>
                            <li><strong>资金管理:</strong> 合理分配资金，避免单一股票仓位过重</li>
                            <li><strong>止损设置:</strong> 为每笔交易设置合理的止损点</li>
                            <li><strong>仓位控制:</strong> 根据市场情况动态调整仓位</li>
                            <li><strong>分散投资:</strong> 不要将所有资金投入单一标的</li>
                            <li><strong>监控异常:</strong> 实时监控交易异常和系统状态</li>
                        </ul>
                        
                        <h4>风险控制代码示例</h4>
                        <div class="code-example">
class RiskController:
    def __init__(self, max_position_pct=0.20, max_daily_loss_pct=0.05):
        self.max_position_pct = max_position_pct  # 单股最大仓位比例
        self.max_daily_loss_pct = max_daily_loss_pct  # 日最大亏损比例
        self.daily_pnl = 0  # 当日盈亏
        self.initial_capital = 0  # 初始资金
    
    def check_position_risk(self, account, stock_code, order_volume, price):
        """检查仓位风险"""
        # 获取账户资产
        asset = xt_trader.query_stock_asset(account)
        if not asset:
            return False, "无法获取账户资产"
        
        total_asset = asset['totalAsset']
        order_amount = order_volume * price
        
        # 检查单股仓位比例
        if order_amount > total_asset * self.max_position_pct:
            return False, f"单股仓位超限，最大允许: {total_asset * self.max_position_pct:.2f}"
        
        return True, "仓位检查通过"
    
    def check_daily_loss(self):
        """检查日亏损限制"""
        if self.initial_capital > 0:
            loss_pct = abs(self.daily_pnl) / self.initial_capital
            if self.daily_pnl < 0 and loss_pct > self.max_daily_loss_pct:
                return False, f"日亏损超限: {loss_pct:.2%}"
        
        return True, "日亏损检查通过"
    
    def safe_order(self, xt_trader, account, stock_code, order_type, order_volume, price_type, price):
        """安全下单"""
        # 仓位风险检查
        if order_type == 23:  # 买入时检查仓位
            risk_ok, risk_msg = self.check_position_risk(account, stock_code, order_volume, price)
            if not risk_ok:
                print(f"风控拒绝: {risk_msg}")
                return -1
        
        # 日亏损检查
        loss_ok, loss_msg = self.check_daily_loss()
        if not loss_ok:
            print(f"风控拒绝: {loss_msg}")
            return -1
        
        # 执行下单
        order_id = xt_trader.order_stock(
            account=account,
            stock_code=stock_code,
            order_type=order_type,
            order_volume=order_volume,
            price_type=price_type,
            price=price
        )
        
        return order_id

# 使用示例
risk_controller = RiskController(max_position_pct=0.15, max_daily_loss_pct=0.03)
account = StockAccount('123456789')

# 安全下单
order_id = risk_controller.safe_order(
    xt_trader=xt_trader,
    account=account,
    stock_code='000001.SZ',
    order_type=23,
    order_volume=1000,
    price_type=11,
    price=12.50
)

if order_id != -1:
    print(f"风控通过，下单成功: {order_id}")
else:
    print("风控拒绝或下单失败")
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>