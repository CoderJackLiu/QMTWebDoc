<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XtQuant 新股申购模块</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            min-height: 100vh;
        }
        
        .sidebar {
            width: 280px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .sidebar-header h2 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .sidebar-header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .nav-menu {
            padding: 20px 0;
        }
        
        .nav-section {
            margin-bottom: 20px;
        }
        
        .nav-section h3 {
            padding: 10px 20px;
            font-size: 0.9rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid #eee;
        }
        
        .nav-section ul {
            list-style: none;
        }
        
        .nav-section li {
            margin: 2px 0;
        }
        
        .nav-section a {
            display: block;
            padding: 8px 20px;
            color: #555;
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .nav-section a:hover {
            background: #f0f0f0;
            color: #667eea;
            padding-left: 25px;
        }
        
        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 40px;
        }
        
        .page-header {
            margin-bottom: 40px;
            text-align: center;
        }
        
        .page-header h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .page-header p {
            font-size: 1.1rem;
            color: #666;
        }
        
        .api-section {
            background: white;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .api-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
            font-size: 1.8rem;
        }
        
        .api-method {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e1e8ed;
            border-radius: 8px;
            background: #fafbfc;
        }
        
        .api-method h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .method-signature {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            margin-bottom: 15px;
            overflow-x: auto;
        }
        
        .method-info {
            margin-bottom: 15px;
        }
        
        .method-info h4 {
            color: #4a5568;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .method-info p, .method-info li {
            color: #666;
            line-height: 1.6;
        }
        
        .method-info ul {
            margin-left: 20px;
        }
        
        .code-example {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            margin-top: 15px;
            overflow-x: auto;
        }
        
        .back-link {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            margin-bottom: 30px;
            transition: all 0.3s ease;
        }
        
        .back-link:hover {
            background: linear-gradient(135deg, #5a6fd8, #6a4190);
            transform: translateY(-2px);
        }
        
        .highlight {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .highlight strong {
            color: #856404;
        }
        
        .info-box {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .info-box strong {
            color: #0c5460;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        .data-table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>新股申购模块</h2>
                <p>新股申购相关API</p>
            </div>
            <nav class="nav-menu">
                <div class="nav-section">
                    <h3>查询接口</h3>
                    <ul>
                        <li><a href="#query_new_purchase_limit">申购额度查询</a></li>
                        <li><a href="#query_ipo_data">当日新股信息查询</a></li>
                    </ul>
                </div>
                <div class="nav-section">
                    <h3>申购操作</h3>
                    <ul>
                        <li><a href="#ipo_order">新股申购下单</a></li>
                        <li><a href="#ipo_strategy">申购策略</a></li>
                    </ul>
                </div>
            </nav>
        </div>
        
        <div class="main-content">
            <a href="xtquant_api_modules.html" class="back-link">← 返回模块首页</a>
            
            <div class="page-header">
                <h1>新股申购模块</h1>
                <p>新股申购相关API接口文档</p>
            </div>
            
            <div class="info-box">
                <strong>新股申购说明:</strong> 新股申购是指投资者在新股发行期间，通过证券账户申请购买新发行股票的过程。申购需要满足一定的市值要求，且有数量限制。
            </div>
            
            <div class="api-section">
                <h2>查询接口</h2>
                
                <div class="api-method" id="query_new_purchase_limit">
                    <h3>新股申购额度查询</h3>
                    <div class="method-signature">query_new_purchase_limit(account)</div>
                    
                    <div class="method-info">
                        <h4>功能说明</h4>
                        <p>查询指定账户的新股申购额度，包括不同市场的可申购股数。</p>
                        
                        <h4>参数</h4>
                        <ul>
                            <li><strong>account</strong> (StockAccount): 资金账号对象</li>
                        </ul>
                        
                        <h4>返回值</h4>
                        <p>dict - 新股申购额度数据集</p>
                        
                        <table class="data-table">
                            <tr>
                                <th>字段</th>
                                <th>类型</th>
                                <th>说明</th>
                            </tr>
                            <tr>
                                <td>KCB</td>
                                <td>int</td>
                                <td>科创板可申购股数</td>
                            </tr>
                            <tr>
                                <td>SH</td>
                                <td>int</td>
                                <td>上海市场可申购股数</td>
                            </tr>
                            <tr>
                                <td>SZ</td>
                                <td>int</td>
                                <td>深圳市场可申购股数</td>
                            </tr>
                        </table>
                        
                        <div class="highlight">
                            <strong>注意:</strong> 申购额度基于T-2日前20个交易日的日均市值计算，每1万元市值可申购1000股（深圳）或1000股（上海）。
                        </div>
                        
                        <h4>示例代码</h4>
                        <div class="code-example">
# 查询新股申购额度
account = StockAccount('123456789')
limits = xt_trader.query_new_purchase_limit(account)

if limits:
    print("新股申购额度:")
    for market, amount in limits.items():
        market_name = {
            'KCB': '科创板',
            'SH': '上海市场', 
            'SZ': '深圳市场'
        }.get(market, market)
        print(f"  {market_name}: {amount:,} 股")
else:
    print("查询申购额度失败")
                        </div>
                    </div>
                </div>
                
                <div class="api-method" id="query_ipo_data">
                    <h3>当日新股信息查询</h3>
                    <div class="method-signature">query_ipo_data()</div>
                    
                    <div class="method-info">
                        <h4>功能说明</h4>
                        <p>查询当日可申购的新股和新债信息，包括发行价格、申购数量限制等。</p>
                        
                        <h4>参数</h4>
                        <p>无参数</p>
                        
                        <h4>返回值</h4>
                        <p>dict - 新股新债信息数据集</p>
                        
                        <table class="data-table">
                            <tr>
                                <th>字段</th>
                                <th>类型</th>
                                <th>说明</th>
                            </tr>
                            <tr>
                                <td>name</td>
                                <td>str</td>
                                <td>证券名称</td>
                            </tr>
                            <tr>
                                <td>type</td>
                                <td>str</td>
                                <td>类型：STOCK(股票) / BOND(债券)</td>
                            </tr>
                            <tr>
                                <td>minPurchaseNum</td>
                                <td>int</td>
                                <td>最小申购数量</td>
                            </tr>
                            <tr>
                                <td>maxPurchaseNum</td>
                                <td>int</td>
                                <td>最大申购数量</td>
                            </tr>
                            <tr>
                                <td>purchaseDate</td>
                                <td>str</td>
                                <td>申购日期</td>
                            </tr>
                            <tr>
                                <td>issuePrice</td>
                                <td>float</td>
                                <td>发行价格</td>
                            </tr>
                        </table>
                        
                        <h4>示例代码</h4>
                        <div class="code-example">
# 查询当日新股信息
ipo_data = xt_trader.query_ipo_data()

if ipo_data:
    print("今日可申购新股/新债:")
    for stock_code, info in ipo_data.items():
        print(f"\n代码: {stock_code}")
        print(f"名称: {info['name']}")
        print(f"类型: {'股票' if info['type'] == 'STOCK' else '债券'}")
        print(f"发行价: {info['issuePrice']} 元")
        print(f"申购范围: {info['minPurchaseNum']:,} - {info['maxPurchaseNum']:,} {'股' if info['type'] == 'STOCK' else '张'}")
        print(f"申购日期: {info['purchaseDate']}")
else:
    print("今日无新股申购")
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="api-section">
                <h2>申购操作</h2>
                
                <div class="api-method" id="ipo_order">
                    <h3>新股申购下单</h3>
                    <div class="method-signature">order_stock(account, stock_code, order_type, order_volume, price_type, price)</div>
                    
                    <div class="method-info">
                        <h4>功能说明</h4>
                        <p>进行新股申购下单操作。新股申购使用普通的下单接口，但需要特定的参数设置。</p>
                        
                        <h4>参数</h4>
                        <ul>
                            <li><strong>account</strong> (StockAccount): 资金账号对象</li>
                            <li><strong>stock_code</strong> (str): 新股申购代码</li>
                            <li><strong>order_type</strong> (int): 订单类型，新股申购通常使用买入(23)</li>
                            <li><strong>order_volume</strong> (int): 申购数量</li>
                            <li><strong>price_type</strong> (int): 价格类型，新股申购使用限价(11)</li>
                            <li><strong>price</strong> (float): 申购价格（发行价）</li>
                        </ul>
                        
                        <h4>返回值</h4>
                        <p>int - 订单编号，-1表示下单失败</p>
                        
                        <div class="highlight">
                            <strong>重要:</strong> 新股申购的价格必须是发行价，数量不能超过申购上限，且必须是最小申购单位的整数倍。
                        </div>
                        
                        <h4>示例代码</h4>
                        <div class="code-example">
# 新股申购示例
account = StockAccount('123456789')

# 假设申购科创板新股
stock_code = '787123.SH'  # 新股申购代码
issue_price = 25.50       # 发行价
apply_volume = 1000       # 申购1000股

# 执行申购
order_id = xt_trader.order_stock(
    account=account,
    stock_code=stock_code,
    order_type=23,        # 买入
    order_volume=apply_volume,
    price_type=11,        # 限价
    price=issue_price
)

if order_id != -1:
    print(f"新股申购成功，订单号: {order_id}")
else:
    print("新股申购失败")
                        </div>
                    </div>
                </div>
                
                <div class="api-method" id="ipo_strategy">
                    <h3>智能申购策略</h3>
                    
                    <div class="method-info">
                        <h4>功能说明</h4>
                        <p>结合申购额度查询和新股信息查询，实现智能化的新股申购策略。</p>
                        
                        <h4>策略要点</h4>
                        <ul>
                            <li>自动查询当日可申购新股</li>
                            <li>检查账户申购额度</li>
                            <li>按照最大可申购数量进行申购</li>
                            <li>支持批量申购多只新股</li>
                        </ul>
                        
                        <h4>示例代码</h4>
                        <div class="code-example">
def auto_ipo_apply(xt_trader, account):
    """
    自动新股申购策略
    """
    # 1. 查询申购额度
    limits = xt_trader.query_new_purchase_limit(account)
    if not limits:
        print("无法获取申购额度")
        return
    
    print("申购额度:")
    for market, amount in limits.items():
        print(f"  {market}: {amount:,} 股")
    
    # 2. 查询当日新股
    ipo_data = xt_trader.query_ipo_data()
    if not ipo_data:
        print("今日无新股申购")
        return
    
    # 3. 逐一申购
    for stock_code, info in ipo_data.items():
        if info['type'] != 'STOCK':  # 只申购股票，跳过债券
            continue
            
        # 确定申购数量
        max_apply = info['maxPurchaseNum']
        
        # 根据市场确定额度
        if stock_code.endswith('.SH'):
            if stock_code.startswith('787'):  # 科创板
                available = limits.get('KCB', 0)
            else:  # 主板
                available = limits.get('SH', 0)
        elif stock_code.endswith('.SZ'):
            available = limits.get('SZ', 0)
        else:
            available = 0
        
        # 计算实际申购数量
        apply_volume = min(max_apply, available)
        
        if apply_volume >= info['minPurchaseNum']:
            # 执行申购
            order_id = xt_trader.order_stock(
                account=account,
                stock_code=stock_code,
                order_type=23,
                order_volume=apply_volume,
                price_type=11,
                price=info['issuePrice']
            )
            
            if order_id != -1:
                print(f"申购成功: {info['name']} ({stock_code}) {apply_volume:,}股")
            else:
                print(f"申购失败: {info['name']} ({stock_code})")
        else:
            print(f"跳过申购: {info['name']} (额度不足)")

# 使用示例
account = StockAccount('123456789')
auto_ipo_apply(xt_trader, account)
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="api-section">
                <h2>申购注意事项</h2>
                
                <div class="api-method">
                    <h3>重要提醒</h3>
                    
                    <div class="method-info">
                        <h4>申购规则</h4>
                        <ul>
                            <li><strong>市值要求:</strong> 申购前20个交易日日均持有市值1万元以上</li>
                            <li><strong>申购时间:</strong> 交易日9:30-11:30, 13:00-15:00</li>
                            <li><strong>申购单位:</strong> 沪市1000股/手，深市500股/手</li>
                            <li><strong>申购次数:</strong> 每只新股只能申购一次，不能撤单</li>
                            <li><strong>资金冻结:</strong> 申购成功后资金被冻结，中签后扣款</li>
                        </ul>
                        
                        <h4>市场差异</h4>
                        <table class="data-table">
                            <tr>
                                <th>市场</th>
                                <th>申购单位</th>
                                <th>市值计算</th>
                                <th>申购时间</th>
                            </tr>
                            <tr>
                                <td>上海主板</td>
                                <td>1000股/手</td>
                                <td>沪市市值</td>
                                <td>9:30-11:30, 13:00-15:00</td>
                            </tr>
                            <tr>
                                <td>科创板</td>
                                <td>500股/手</td>
                                <td>沪市市值</td>
                                <td>9:30-11:30, 13:00-15:00</td>
                            </tr>
                            <tr>
                                <td>深圳主板</td>
                                <td>500股/手</td>
                                <td>深市市值</td>
                                <td>9:15-11:30, 13:00-15:00</td>
                            </tr>
                            <tr>
                                <td>创业板</td>
                                <td>500股/手</td>
                                <td>深市市值</td>
                                <td>9:15-11:30, 13:00-15:00</td>
                            </tr>
                        </table>
                        
                        <h4>常见错误</h4>
                        <ul>
                            <li>申购数量超过上限</li>
                            <li>申购价格不等于发行价</li>
                            <li>重复申购同一只新股</li>
                            <li>申购时间超出范围</li>
                            <li>账户市值不足</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>